---
date: 2021-12-11 23:18
description: UserDefaultsì™€ CoreData
tags: iOS, Swift
---

## UserDefaultsì™€ CoreDataë¡œ ë””ë°”ì´ìŠ¤ì— ë°ì´í„°ë¥¼ ì €ì¥í•´ë³´ì.

<br/>
### <b class="bold">UserDefaults</b>ì™€ <b class="bold">CoreData</b>ëŠ” ë‘˜ ë‹¤ ë””ë°”ì´ìŠ¤ì— ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•´ì¤€ë‹¤.
### ë‘˜ì˜ <b class="heavy">ì°¨ì´ì </b>ê³¼ <b class="heavy">ì¥ë‹¨ì </b>, <b class="heavy">ì‚¬ìš©ë°©ë²•</b>ì— ëŒ€í•´ ê°„ë‹¨íˆ ì •ë¦¬í•´ë³´ì.
<br/>

## UserDefaults?

### ì• í”Œì˜ ê°œë°œì ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ë©´
<br/>
<img src="/images/userDefaultsImage.png"/>

<blockquote><b class="inyong">ì•±ì„ ì‹¤í–‰í•˜ëŠ” ë™ì•ˆ ì§€ì†ì ìœ¼ë¡œ í‚¤-ê°’ ìŒì„ ì €ì¥í•˜ëŠ” ì‚¬ìš©ìì˜ ê¸°ë³¸ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.</b></blockquote>

### ì´ë¼ ì •ì˜ë˜ì–´ìˆë‹¤.
<br/>
### <b class="heavy">í‚¤-ê°’ì˜ ìŒ</b>ì„ ì €ì¥í•˜ëŠ” ê²ƒì„ ë³´ë‹ˆ <b class="bold">ë”•ì…”ë„ˆë¦¬</b> êµ¬ì¡°ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤!

## UserDefaults ì‚¬ìš©í•˜ê¸°

### ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ìƒê°ë³´ë‹¤ ì‰½ë‹¤.
<br/>

<img src="/images/userDefaultsCodeImage.png"/>

### ì½”ë“œëŠ” ì£¼ì„ìœ¼ë¡œ ì„¤ëª…í•´ë†¨ë‹¤.
### <b class="heavy">UserDefaults</b>ëŠ” <b class="heavy">Foundation</b>ì— ìˆëŠ” í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— ê¼­ importí•´ì£¼ì.
### <b class="heavy">UserDefaults</b>ì— ê°’ì„ ì¶”ê°€í•˜ëŠ” <b class="heavy">set()</b>ì˜ ì²«ë²ˆì§¸ ì¸ìì— ì €ì¥í•  ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ë©´ ë˜ëŠ”ë°, ì²«ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ì˜ ìë£Œí˜•ì´ <b class="heavy">Any</b>ì¸ set()ì´ ìˆê¸° ë•Œë¬¸ì— íŠ¹ë³„íˆ ìë£Œí˜•ì— êµ¬ì• ë°›ì§€ ì•ŠëŠ”ë‹¤.

### ì´ëŸ¬í•œ íŠ¹ì§•ì„ ê°€ì§„ <b class="bold">UserDefaults</b>ëŠ” ì‚¬ìš©ì ê¸°ë³¸ ì„¤ì •ê³¼ ê°™ì€ ë‹¨ì¼ ë°ì´í„° ê°’ì— ì í•©í•˜ë‹¤.

## CoreData?
### ë§ˆì°¬ê°€ì§€ë¡œ ì• í”Œì˜ ê°œë°œì ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ë©´
<br/>
<img src="/images/coreDataImage.png"/>

<blockquote><b class="inyong">ë‹¨ì¼ ì¥ì¹˜ì—ì„œ ë°ì´í„°ë¥¼ ìœ ì§€ ë˜ëŠ” ìºì‹œí•˜ê±°ë‚˜ CloudKitì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ì¥ì¹˜ì— ë°ì´í„°ë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤.</b></blockquote>
### ì´ë¼ ì •ì˜ë˜ì–´ìˆë‹¤.
<br/>
### <b class="bold">CoreData</b>ëŠ” ì•±ì—ì„œ ëª¨ë¸ ê³„ì¸µ ê°œì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” <b class="bold">í”„ë ˆì„ì›Œí¬</b>ì´ë‹¤.


### <b class="bold">CoreData</b>ì—ëŠ” <b class="heavy">Persistenced, ë³€ê²½ ì‚¬í•­ Undo & Redo, ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ì‘ì—…, ë™ê¸°í™”, ë²„ì „ ê´€ë¦¬ ë° Migration ê¸°ëŠ¥</b>ì„ ì œê³µí•œë‹¤.

### ìš°ë¦¬ê°€ ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì€ <b class="bold">Persistenced</b>ìœ¼ë¡œ

<blockquote><b class="inyong">Core DataëŠ” ê°œì²´ë¥¼ ì €ì¥ì†Œì— ë§¤í•‘í•˜ëŠ” ì„¸ë¶€ ì •ë³´ë¥¼ ì¶”ìƒí™”í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•Šê³ ë„ Swift ë° Objective-Cì—ì„œ ë°ì´í„°ë¥¼ ì‰½ê²Œ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</b></blockquote>

### ë¼ê³  ì •ì˜ë˜ì–´ìˆë‹¤.

## CoreData ì‚¬ìš©í•˜ê¸°
### í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•  ë•Œ <b class="bold">Use Core Data</b>ë¥¼ ì²´í¬í•˜ê³  ìƒì„±í•´ì¤€ë‹¤.
<br/>

<img src="/images/projectInitImage.png"/>

### ì²´í¬ë¥¼ ì•ˆí•˜ê³  ìƒì„±í•œ í”„ë¡œì íŠ¸ì— ì ìš©í•˜ë ¤ë©´ <b class="heavy">ApplDelegate</b> íŒŒì¼ì„ ìˆ˜ì •í•´ ì¤˜ì•¼í•œë‹¤.

```swift
// MARK: - Core Data stack

lazy var persistentContainer: NSPersistentContainer = {
    /*
     The persistent container for the application. This implementation
     creates and returns a container, having loaded the store for the
     application to it. This property is optional since there are legitimate
     error conditions that could cause the creation of the store to fail.
    */
    // DataCoreì™€ ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì„¸íŒ…
    let container = NSPersistentContainer(name: "blogEx")
    container.loadPersistentStores(completionHandler: { (storeDescription, error) in
        if let error = error as NSError? {
            // Replace this implementation with code to handle the error appropriately.
            // fatalError() causes the application to generate a crash log and terminate. You should not use this function in a shipping application, although it may be useful during development.
             
            /*
             Typical reasons for an error here include:
             * The parent directory does not exist, cannot be created, or disallows writing.
             * The persistent store is not accessible, due to permissions or data protection when the device is locked.
             * The device is out of space.
             * The store could not be migrated to the current model version.
             Check the error message to determine what the actual problem was.
             */
            fatalError("Unresolved error \(error), \(error.userInfo)")
        }
    })
    return container
}()
```

### ìƒˆ íŒŒì¼ì„ ë§Œë“¤ë“¯ì´ <b class="heavy">data Model</b>íŒŒì¼ì„ ìƒì„±í•´ì¤€ í›„, í•´ë‹¹ ì†ŒìŠ¤ì½”ë“œë¥¼ <b class="<b class="heavy"">AppDelegate</b>ì— ì¶”ê°€í•´ì£¼ê³  ì´ë¦„ì„ ë˜‘ê°™ì´ ìˆ˜ì •í•´ì£¼ë©´ ëœë‹¤.
<br/>

<img src="/images/dataCoreModelImage.png"/>

### ë§Œë“¤ì–´ì§„ <b class="heavy">data Model</b> íŒŒì¼ì„ ì—´ì–´ë³´ë©´ ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´ ìƒê²¼ë‹¤. ì•„ë˜ì— ìˆëŠ” <b class="bold">Add Entity</b>ë¥¼ ëˆŒëŸ¬ ìƒˆë¡œìš´ ì—”í‹°í‹°ë¥¼ ìƒì„±í•´ì¤€ë‹¤. ì—¬ê¸°ì„œ <b class="heavy">Entity</b>ëŠ” CoreDataì— ì €ì¥ë  ê°ì²´ë¥¼ ì˜ë¯¸í•œë‹¤. (ì˜ˆë¥¼ ë“¤ì–´ ìµœê·¼ê²€ìƒ‰ì–´ì˜ ê²€ìƒ‰ ê°ì²´.)
### ì¶”ê°€ë¡œ ì˜¤ë¥¸ìª½ ì•„ë˜ìˆëŠ” <b class="bold">AddAttribute</b> ë²„íŠ¼ìœ¼ë¡œ ì†ì„±ì„ ì¶”ê°€í•´ ì¤€ë‹¤. ì—¬ê¸°ì„œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ idì™€ stringì„ ìƒì„±í•´ì£¼ì—ˆë‹¤.
<br/>

<img src="/images/managedCodegenImage.png"/>

### ìš°ë¦¬ëŠ” <b class="heavy">CoreData</b>ê°€ ìƒì„±í•œ managed object subclass ë° í”„ë¡œí¼í‹° ë˜ëŠ” ê¸°ëŠ¥ì„ í¸ì§‘í•  ê²ƒì´ê¸° ë•Œë¬¸ì— <b class="heavy">Codegen</b>ì†ì„±ì„ ë°”ê¿”ì¤„ í•„ìš”ê°€ ìˆë‹¤. ì¸ìŠ¤í™í„°ì—ì„œ Codegenì„ <b class="heavy">Manual/None</b>ìœ¼ë¡œ ë°”ê¿”ì£¼ì.
<br/>

<img src="/images/createManagedObjectImage.png"/>

### ê·¸ í›„ ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ Editorì—ì„œ <b class="heavy">Create NSManagedObejct Subclass...</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ í´ë˜ìŠ¤ íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤.
### ê·¸ëŸ¼ ìš°ë¦¬ê°€ ìƒì„±í–ˆë˜ Entityì˜ extensionì„ xcodeê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.
### ë§ˆì§€ë§‰ìœ¼ë¡œ <b class="heavy">CoreDataManager</b> íŒŒì¼ì„ ë§Œë“¤ì–´ get, set, delete ë“±ì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ ì£¼ë©´ ëì´ë‹¤.
### ì•„ë˜ëŠ” <b class="heavy">CoreDataManager</b> íŒŒì¼ì˜ ì†ŒìŠ¤ì½”ë“œì´ë‹¤.


```swift
import UIKit
import CoreData

enum CoreDataName: String {
    case entity = "Entity"
}

class CoreDataManager {
    static let shared: CoreDataManager = CoreDataManager()
    
    private let appDelegate = UIApplication.shared.delegate as? AppDelegate
    private lazy var context = appDelegate?.persistentContainer.viewContext
    
    // MARK: - í•´ë‹¹ ì •ë³´ë¥¼ ì €ì¥í•œë‹¤
    func saveEntity(id: Int16, name: String, completion: @escaping (Bool) -> Void) {
        guard let context = self.context,
              let entity = NSEntityDescription.entity(forEntityName: CoreDataName.entity.rawValue, in: context)
        else { return }
        
        guard let Entity = NSManagedObject(entity: entity, insertInto: context) as? Entity else { return }
        
        Entity.id = id
        Entity.string = name
        
        do {
            try context.save()
            completion(true)
        } catch {
            print(error.localizedDescription)
            completion(false)
        }
    }
    
    // MARK: - í•´ë‹¹ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    func getEntity(ascending: Bool = false) -> [Entity]{
        var models: [Entity] = [Entity]()
        
        if let context = context {
            let idSort: NSSortDescriptor = NSSortDescriptor(key: "id", ascending: ascending)
            let fetchRequest: NSFetchRequest<NSManagedObject> = NSFetchRequest<NSManagedObject>(entityName: CoreDataName.entity.rawValue)
            fetchRequest.sortDescriptors = [idSort]
            
            do{
                if let fetchResult: [Entity] = try context.fetch(fetchRequest) as? [Entity] {
                    models = fetchResult
                }
            } catch let error as NSError {
                print("Could not fetch: \(error), \(error.userInfo)")
            }
        }
        return models
    }
    // MARK: - í•´ë‹¹ ì •ë³´ë¥¼ ì‚­ì œí•œë‹¤.
    func deleteEntity(id: Int16, onSuccess: @escaping ((Bool) -> Void)) {
        let fetchRequest: NSFetchRequest<NSManagedObject> = NSFetchRequest<NSManagedObject>(entityName: CoreDataName.entity.rawValue)
        do {
            if let results: [Entity] = try context!.fetch(fetchRequest) as? [Entity] {
                if results.count != 0 {
                    context?.delete(results[Int(id)])
                }
            }
        } catch let error as NSError {
            print("Could not fatchğŸ¥º: \(error), \(error.userInfo)")
            onSuccess(false)
        }
        contextSave { success in
            onSuccess(success)
        }
    }
}

extension CoreDataManager {
    fileprivate func filteredRequest(id: Int16) -> NSFetchRequest<NSFetchRequestResult> {
        let fetchRequest: NSFetchRequest<NSFetchRequestResult>
            = NSFetchRequest<NSFetchRequestResult>(entityName: CoreDataName.entity.rawValue)
        fetchRequest.predicate = NSPredicate(format: "index = %@", NSNumber(value: id))
        return fetchRequest
    }
    
    fileprivate func contextSave(onSuccess: ((Bool) -> Void)) {
        do {
            try context?.save()
            onSuccess(true)
        } catch let error as NSError {
            print("Could not saveğŸ¥¶: \(error), \(error.userInfo)")
            onSuccess(false)
        }
    }
}

```
<br/>

<img src="/images/coreDataCodeImage.png"/>

### ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ë©´ ì˜ ì‘ë™í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
### <b class="heavy">CoreData</b>ëŠ” ë”•ì…”ë„ˆë¦¬ë¡œ ê´€ë¦¬ë˜ëŠ” <b class="heavy">UserDefaults</b>ì™€ëŠ” ë‹¬ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ê°€ ê¸°ë°˜ì´ê¸° ë•Œë¬¸ì— ë” ë³µì¡í•˜ê³  í° ê°ì²´ë¥¼ ë‹¤ë£°ë•Œ ìš©ì´í•˜ê²Œ ì‚¬ìš©ë  ê²ƒ ê°™ë‹¤.

## ì°¸ê³ ìë£Œ
<ul>
<li>
    <a href="https://hyerios.tistory.com/8">hyerios tistory blog</a>
</li>
<li>
    <a href="https://zeddios.tistory.com/987">ZeddiOS</a>
</li>
</ul>
